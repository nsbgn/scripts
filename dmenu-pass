#!/bin/sh
# A simple dmenu interface to the password manager `pass`.
# Dependencies: (Debian) bemenu pass coreutils findutils sed wtype xdotool

if [ -z $PASSWORD_STORE_DIR ]; then
    PASSWORD_STORE_DIR="$HOME/.password-store"
fi

DMENU="bemenu -i --no-exec"
if [ ! -z "$WAYLAND_DISPLAY" ]; then
    TYPIST="wtype -"
else
    TYPIST="xdotool type --clearmodifiers --file -"
fi

find $PASSWORD_STORE_DIR/ -iname '*.gpg' \
| sed "s|^$PASSWORD_STORE_DIR/\(.*\).gpg|\1|" \
| sort \
| $DMENU \
| xargs --no-run-if-empty pass show \
| $TYPIST
